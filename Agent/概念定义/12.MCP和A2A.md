### 11. å…³äº MCP å’Œ A2A
ä¸€å¼ å›¾è¯´æ˜ MCP å’Œ A2A çš„å…³ç³»

<img width="379" height="207" alt="image" src="https://github.com/user-attachments/assets/d91d2f32-29e2-49df-863f-eed8613b9b6e" />


### 11.1 ä» Function Call èŠèµ·
è¯´åˆ° **AI è°ƒç”¨å·¥å…·**ï¼Œå¾ˆå¤šæŒç»­å…³æ³¨è¿™ä¸ªæ–¹å‘çš„äººï¼Œé¦–å…ˆä¼šæƒ³åˆ°çš„æ˜¯ **OpenAI** åœ¨ 2023 å¹´ 7 æœˆ 20 æ—¥å‘å¸ƒçš„â€œ**å‡½æ•°è°ƒç”¨åŠå…¶ä»– API æ›´æ–°**â€åŠŸèƒ½ã€‚**OpenAI** é€šè¿‡åœ¨ API è¯·æ±‚ä¸­ä¼ å…¥ **functions** å‚æ•°ï¼Œè®©å¤§æ¨¡å‹èƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚

ä¾‹å¦‚ï¼ˆ**OpenAI** å®˜æ–¹æä¾›æ¡ˆä¾‹ï¼‰ï¼š
é—®é¢˜ï¼šWhat's the weather like in Boston right now?
- **æ­¥éª¤ä¸€**ï¼šä½¿ç”¨å‡½æ•°å’Œç”¨æˆ·è¾“å…¥è°ƒç”¨æ¨¡å‹ï¼ˆCall the model with functions and the user's inputï¼‰
  - Request
 

  ```bash
curl https://api.openai.com/v1/chat/completions -u :$OPENAI_API_KEY -H 'Content-Type: application/json' -d '{
  "model": "gpt-3.5-turbo-0613",
  "messages": [
    {"role": "user", "content": "What is the weather like in Boston?"}
  ],
  "functions": [
    {
      "name": "get_current_weather",
      "description": "Get the current weather in a given location",
      "parameters": {
        "type": "object",
        "properties": {
          "location": {
            "type": "string",
            "description": "The city and state, e.g. San Francisco, CA"
          },
          "unit": {
            "type": "string",
            "enum": ["celsius", "fahrenheit"]
          }
        },
        "required": ["location"]
      }
    }
  ]
}'
```
- Response
### ä»£ç 
```json
{
  "id": "chatcmpl-123",
  ...
  "choices": [{
    "index": 0,
    "message": {
      "role": "assistant",
      "content": null,
      "function_call": {
        "name": "get_current_weather",
        "arguments": "{ \"location\": \"Boston, MA\"}"
      }
    },
    "finish_reason": "function_call"
  }]
}
```


- æ­¥éª¤äºŒï¼šä½¿ç”¨æ¨¡å‹å“åº”è°ƒç”¨APIï¼ˆUse the model response to call your APIï¼‰
- æ­¥éª¤ä¸‰ï¼šå°†å“åº”è¿”å›ç»™æ¨¡å‹ä»¥è¿›è¡Œæ€»ç»“ï¼ˆSend the response back to the model to summarizeï¼‰
  - Responseï¼š
    ```json
    {
      "id": "chatcmpl-123",
      ...
      "choices": [{
        "index": 0,
        "message": {
          "role": "assistant",
          "content": "The weather in Boston is currently sunny with a temperature of 22 de",
        },
        "finish_reason": "stop"
      }]
    }
    ```
- Function Call åŠŸèƒ½æå¤§åœ°æå‡äº†å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

1. ä¸æ˜¯æ‰€æœ‰å¤§æ¨¡å‹éƒ½æ”¯æŒ Function Callï¼›
2. å„å®¶å¤§æ¨¡å‹å¯¹ Function Call çš„è§¦å‘ç²¾å‡†åº¦å·®å¼‚è¾ƒå¤§â€”â€”åŒæ ·çš„é—®é¢˜ï¼Œæœ‰æ—¶ä¼šè°ƒç”¨å·¥å…·ï¼Œæœ‰æ—¶ä¸ä¼šã€‚
# 11.2-MCP
<img width="510" height="136" alt="image" src="https://github.com/user-attachments/assets/9cd0e9fd-c746-4613-894d-8ebff4544d91" />


- ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒAnthropic æå‡ºäº† MCP åè®®ï¼ˆModel Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ï¼Œå¹¶äº 2024 å¹´ 11 æœˆ 25 æ—¥æ­£å¼å‘å¸ƒã€‚
- MCP åè®®ä¸å‡½æ•°è°ƒç”¨çš„åŸç†ç±»ä¼¼ï¼Œéƒ½æ˜¯å‘å¤§æ¨¡å‹æä¾›å·¥å…·å®šä¹‰ä¿¡æ¯ï¼Œè®©æ¨¡å‹è‡ªä¸»å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·ä»¥åŠè°ƒç”¨å“ªä¸ªå·¥å…·ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼ŒMCP æ˜¯å°†å·¥å…·çš„ JSON Schema ç›´æ¥å†™å…¥æç¤ºè¯ï¼ˆPromptï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ä½œä¸º API å‚æ•°ä¼ é€’ã€‚
- ä¾‹å¦‚ï¼ŒCline çš„ MCP è¯·æ±‚ä¼šæŠŠæ‰€æœ‰ MCP å·¥å…·çš„å®šä¹‰å’Œç”¨æ³•å†™è¿›æç¤ºè¯ï¼š

```json
{
  "model": "deepseek/deepseek-v3-base:free",
  "messages": [
    {
      "role": "system",
      "content": "You are Cline, a highly skilled software engineer with extensive knowle"
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "<task>\nä»ä¸œèå—åŸæ±½è½¦ç«™éª‘è¡Œåˆ°æ¾å±±æ¹–å¤§æ¦‚è¦å¤šä¹…ï¼Ÿ\n</task>"
        },
        {
          "type": "text",
          "text": "<environment_details>\n# VSCode Visible Files\n(No visible files)\n\n#"
        }
      ]
    }
  ],
  "temperature": 0,
  "stream": true,
  "stream_options": {
    "include_usage": true
  }
}
```

- Function Call å’Œ MCP å¯¹æ¯”ï¼š
  - Function Call æ˜¯åœ¨æ¨¡å‹è®­ç»ƒçš„æ—¶å€™å°±å†…ç½®äº†å·¥å…·è°ƒç”¨åŠŸèƒ½ï¼Œè€Œ MCP æœ¬è´¨ä¸Šåˆ™æ˜¯ä¸€ä¸ªæç¤ºè¯å·¥ç¨‹ï¼Œå®ƒé€šè¿‡åœ¨æç¤ºè¯ä¸­åŠ å…¥äº†å·¥å…·è°ƒç”¨çš„è§„åˆ™è®©å¤§æ¨¡å‹ç°å­¦ç°ç”¨ã€‚
  - MCP æ˜¯åˆ©ç”¨äº† AI çš„â€œå°æ ·æœ¬å­¦ä¹ â€èƒ½åŠ›ï¼Œè€Œè¿™ä¸ªèƒ½åŠ›å‡ ä¹æ‰€æœ‰çš„ AI å¤§æ¨¡å‹éƒ½å…·å¤‡çš„ï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯ä¸€ä¸ªé€šç”¨çš„åè®®ã€‚ç”±äºè¿™ä¸ªåè®®æ˜¯å†™åœ¨æ¨¡å‹çš„ä¸Šä¸‹æ–‡æç¤ºè¯ä¸­çš„ï¼Œæ‰€ä»¥åˆè¢«ç§°ä¹‹ä¸ºâ€œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®â€ã€‚
 
### 11.3 ä»€ä¹ˆæ˜¯ A2A
- **A2Aåè®®ï¼ˆAgent - to - Agent Protocolï¼‰** æ˜¯ç”± **Google** äº2025å¹´4æœˆ9æ—¥å‘å¸ƒçš„å¼€æ”¾åè®®ï¼Œæ—¨åœ¨å®ç°AIæ™ºèƒ½ä½“ï¼ˆAgentï¼‰ä¹‹é—´çš„æ ‡å‡†åŒ–é€šä¿¡ä¸åä½œã€‚
- è¿™ä¸ªåè®®çš„æ ¸å¿ƒç›®æ ‡æ˜¯**è®©ä¸åŒä¾›åº”å•†ã€ä¸åŒæ¡†æ¶å¼€å‘çš„æ™ºèƒ½ä½“èƒ½å¤Ÿè·¨å¹³å°æ— ç¼åä½œ**ã€‚

ğŸ¦„ **Agent é—´çš„â€œé€šç”¨è¯­è¨€â€**ã€‚

<img width="501" height="211" alt="image" src="https://github.com/user-attachments/assets/ea6c1467-0143-4f1d-9ccf-ef95e959ae43" />


### äº¤äº’æ–¹å¼ï¼š
- é€šè¿‡**â€œAgent Cardâ€**ï¼ˆä¸€ç§ JSON æ ¼å¼çš„æ–‡ä»¶ï¼ŒåŒ…å« Agent çš„ IDã€åç§°ã€èƒ½åŠ›ã€ç‰ˆæœ¬ã€å®‰å…¨éœ€æ±‚ç­‰ä¿¡æ¯ï¼‰ï¼Œ**ä¸€ä¸ª Agent å¯ä»¥æ‰¾åˆ°å¹¶äº†è§£å…¶ä»– Agent çš„èƒ½åŠ›**ã€‚

```json
====== Agent Card ======
{
    "name": "Parse and Chat",
    "description": "Parses a file and then chats with a user using the parsed content as context.",
    "url": "http://localhost:10010/",
    "version": "1.0.0",
    "capabilities": {
        "streaming": true,
        "pushNotifications": true,
        "stateTransitionHistory": false
    },
    "defaultInputModes": ["text", "text/plain"],
    "defaultOutputModes": ["text", "text/plain"],
    "skills": [{
        "id": "parse_and_chat",
        "name": "Parse and Chat",
        "description": "Parses a file and then chats with a user using the parsed content as context.",
        "tags": ["parse", "chat", "file", "llama_parse"],
        "examples": ["What does this file talk about?"]
    }]
}
======== starting a new task ======
```

è¿™ä¸ªè¢« `====== Agent Card ======` åŒ…è£¹çš„ JSON å¯¹è±¡å°±æ˜¯å®˜æ–¹ Demo ä¸­ LlamaIndex Agent çš„ Agent Card ç¤ºä¾‹ã€‚

é‡Œé¢åŒ…å«äº†

```
1. `name: "Parse and Chat"`
2. `description: Agent åŠŸèƒ½æè¿°`
3. `url: Agent çš„è®¿é—®åœ°å€`
4. `version: ç‰ˆæœ¬å·`
5. `capabilities: æ”¯æŒçš„èƒ½åŠ›ï¼ˆæµå¼ã€æ¨é€é€šçŸ¥ç­‰ï¼‰`
6. `defaultInputModes / defaultOutputModes: æ”¯æŒçš„é»˜è®¤è¾“å…¥è¾“å‡ºæ ¼å¼`
7. `skills: Agent æ‹¥æœ‰çš„æŠ€èƒ½åˆ—è¡¨ï¼Œæ¯ä¸ªæŠ€èƒ½æœ‰ IDã€åç§°ã€æè¿°ã€æ ‡ç­¾å’Œç¤ºä¾‹ã€‚`
```
## æ€»ç»“
### è¡¨æ ¼å†…å®¹
| ç‰¹æ€§       | A2A                                                                 | MCP                                                                 |
|------------|---------------------------------------------------------------------|---------------------------------------------------------------------|
| æ ¸å¿ƒç›®æ ‡   | æ ‡å‡†åŒ– Agent ä¹‹é—´çš„é€šä¿¡å’Œåä½œ                                       | æ ‡å‡†åŒ– Agent/åº”ç”¨ä¸å¤–éƒ¨å·¥å…·/æ•°æ®æºä¹‹é—´çš„ä¸Šä¸‹æ–‡äº¤äº’                   |
| äº¤äº’å±‚é¢   | Agent â†” Agentï¼ˆæ°´å¹³é›†æˆï¼‰                                           | Agent/åº”ç”¨ â†” å·¥å…·/æ•°æ®æºï¼ˆå‚ç›´é›†æˆï¼‰                               |
| è§£å†³é—®é¢˜   | å¦‚ä½•è®©ä¸åŒæ¥æºã€ä¸åŒæ¡†æ¶çš„ Agent äº’ç›¸å‘ç°ã€å¯¹è¯ã€å§”æ‰˜ä»»åŠ¡ã€åè°ƒå·¥ä½œæµï¼Ÿ | å¦‚ä½•è®©ä¸€ä¸ª Agent/LLM æ ‡å‡†åŒ–ã€å®‰å…¨ã€é«˜æ•ˆåœ°è°ƒç”¨å¤–éƒ¨ APIã€è®¿é—®æ•°æ®åº“ã€è·å–å®æ—¶æ•°æ®ç­‰â€œå·¥å…·â€ |
| é€šä¿¡å†…å®¹   | ä»»åŠ¡æŒ‡ä»¤ã€çŠ¶æ€æ›´æ–°ã€åä½œè¯·æ±‚ã€ç»“æœå·¥ä½œã€ä¸Šä¸‹æ–‡å…±äº«ã€åå•†             | ä¼ é€’ç»™æ¨¡å‹çš„ç»“æ„åŒ–ä¸Šä¸‹æ–‡ã€å·¥å…·åˆ—è¡¨ã€å·¥å…·è°ƒç”¨è¯·æ±‚ã€å·¥å…·æ‰§è¡Œç»“æœ       |
| è®¾æƒ³ç±»æ¯”   | Agent ä¹‹é—´çš„å†…éƒ¨æ¶ˆæ¯æ€»çº¿æˆ–åä½œæ¡†æ¶                                   | AI åº”ç”¨è¿æ¥å¤–éƒ¨å·¥å…·çš„"USB - C"æ¥å£                                   |
| ä¸»è¦å‘èµ·è€… | Google                                                              | Anthropic                                                           |
| å…¸å‹åœºæ™¯   | å¤š Agent ç³»ç»Ÿã€å¤æ‚å·¥ä½œæµè‡ªåŠ¨åŒ–ã€è·¨å¹³å°åä½œ                         | å•ä¸ª Agent éœ€è¦è°ƒç”¨å¤šç§å¤–éƒ¨å·¥å…·ï¼Œå¢å¼º LLM çš„ä¸Šä¸‹æ–‡ç†è§£å’Œæ‰§è¡Œèƒ½åŠ›     |


- MCP å…³æ³¨çš„æ˜¯ Agent å¦‚ä½•ä½¿ç”¨å·¥å…· (Agent - to - Tool/Context)ã€‚å®ƒè®© Agent æ›´æ–¹ä¾¿åœ°è¿æ¥å’Œä½¿ç”¨å„ç§å¤–éƒ¨èµ„æºï¼ˆå¦‚ APIã€æ•°æ®åº“ï¼‰ã€‚
- A2A å…³æ³¨çš„æ˜¯ Agent å¦‚ä½•äº’ç›¸åˆä½œ (Agent - to - Agent)ã€‚å®ƒè®©ä¸åŒçš„ Agent èƒ½å¤Ÿåƒä¸€ä¸ªå›¢é˜Ÿä¸€æ ·ååŒå·¥ä½œã€‚
