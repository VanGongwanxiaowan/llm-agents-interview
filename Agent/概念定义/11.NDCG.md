### 10. NDCG 进一步理解 —— 从 G → CG → DCG → NDCG 的直观理解
在搜索和推荐领域，**NDCG（Normalized Discounted Cumulative Gain，归一化折损累计增益）** 是常见的排序评估指标。它不仅能判断是否“选对”了对象，还能衡量排序顺序的好坏。
例如，当我们检索【推荐排序】，网页返回了与推荐排序相关的链接列表。列表可能会是[A,B,C,G,D,E,F]，也可能是[C,F,A,E,D]，
现在问题来了，**当系统返回这些列表时，怎么评价哪个列表更好？**

在 **Agent 工具选择（Tool Selection）** 的场景中，NDCG 同样适用：
- 不同工具对任务的相关性不同；
- 高相关的工具应该尽早被调用；
- 评估时不仅看是否包含正确工具，还要看调用顺序是否合理。

接下来我们用一个案例，从 **G → CG → DCG → NDCG** 四步来理解。

### 10.1 G（Gain，增益）
**每个工具对任务的重要性用一个分数表示**：
$$G = rel$$
其中 $rel$ 是相关性分数。
- 假设任务是“获取天气信息并翻译结果”。系统中有五个工具：

<img width="737" height="370" alt="image" src="https://github.com/user-attachments/assets/4864cc1c-c939-414e-8a43-9ff11b360b77" />


<img width="522" height="328" alt="image" src="https://github.com/user-attachments/assets/3334a351-4de5-4a3b-8c85-296d9e0478ce" />


<img width="752" height="454" alt="image" src="https://github.com/user-attachments/assets/796ce134-bc68-4d69-ad08-53a6fd536e67" />

<img width="769" height="470" alt="image" src="https://github.com/user-attachments/assets/51511f43-fe74-4ba7-b9da-5cd7376d05d9" />


### 10.5 总结
🚄 **NDCG总结**：
- **G**：给工具打分，反映任务相关性；
- **CG**：累计增益，但无法反映顺序优劣；
- **DCG**：引入位置折损，高相关工具排前才更合理；
- **NDCG**：归一化，数值范围 [0,1]，支持跨任务比较。

在 **Agent 工具选择** 的评估中，**NDCG** 不仅衡量“是否选对工具”，更能反映“调用顺序是否合理”。这让它成为比准确率更合适的指标。






