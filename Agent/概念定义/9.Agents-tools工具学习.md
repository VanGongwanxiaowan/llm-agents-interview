## tools:out keys to the outside wolrd.--google

<img width="762" height="661" alt="image" src="https://github.com/user-attachments/assets/430ec694-8679-462c-8737-e7ca1a5a7c5d" />

### 工具学习所包含的四个关键阶段：
1. **任务规划（Task Planning）**
   - 模型首先解析用户输入，理解意图并将复杂任务拆解成多个可解决的子任务。
2. **工具选择（Tool Selection）**
   - 根据每个子任务选择最适合的工具。工具选择分两种方式：
     - **Retriever - based selection**：使用检索模块选出 top - k 可能相关工具；
     - **LLM - based selection**：直接由模型判断并选择工具。
3. **工具调用（Tool Calling）**
   - 模型需构建调用指令（如 API 请求、函数名 + 参数等），确保格式正确并执行调用。
4. **响应生成（Response Generation）**
   - 收集工具返回结果，并将其恰当地整合进最终输出中。

### 两种不同的操作流程：
- **一步式任务解决（One - step Task Solving）**
  - 模型在接收到用户问题后，一次性确定所有子任务与所需工具，然后调用这些工具并生成回应。
  - 整个流程不考虑中途可能出现的调用错误，也不会根据反馈调整计划。
- **迭代式任务解决（Iterative Task Solving）**
  - 模型不是一次性规划所有步骤，而是一步步调用工具、获取反馈、然后调整后续的子任务与工具使用。
  - 这种方式更具灵活性和鲁棒性，能够根据工具的实际表现不断修正策略。


### 8.1 任务规划（Task Planning）
- **任务规划**是工具学习过程中的首要阶段，它涉及对用户查询的全面分析，以理解用户意图。
- 用户的问题往往包含复杂的意图，需要被分解为多个可执行的子问题。

### 8.1.1 任务规划的步骤
- **a. 任务分解**：将用户的问题分解为多个子问题，这有助于逐步解决复杂问题。
- **b. 依赖关系和执行顺序**：确定子问题之间的依赖关系以及它们应该被执行的顺序。

### 8.1.2 举例
#### An Example for Task Planning with GPT - 4
- **Instruction Prompt**: You are currently in the task planning stage. You are given a user query requiring multi - step actions and reasoning. You will break down the user's query into sub - questions, and you only need to output these sub - questions after the breakdown. Ensure that the original problem is comprehensively covered through the minimal number of sub - questions.
- **User Question**: I would like to know the value of 5 ounces of gold plus 1 million AMZN stocks in CNY.
- **Output**: 1. What is the current price of gold per ounce in USD? 2. What is the current stock price of Amazon (AMZN) per share in USD? 3. What is the current exchange rate between USD and CNY (Chinese Yuan)?

任务规划（Task Planning）举例

#### Instruction Prompt（指令提示）
- 模型当前处于**任务规划**阶段。
- 输入是一个需要多步推理和操作的用户问题。
- 模型的任务是：
  - 把用户的问题拆解成子问题（sub - questions）
  - 子问题的数量要尽量少，但必须覆盖原问题的所有部分。
  - 只需要输出拆分后的子问题，不需要立即解答。

#### User Question（用户问题）
我想知道 5 盎司黄金 + 100 万股亚马逊股票 的 人民币价值。
这是一个复合性问题，包含了黄金、股票和汇率三个不同信息来源。

#### Output（模型拆分结果）
模型把用户问题拆解成了三个子问题：


1. 当前黄金每盎司的美元价格是多少？
2. 亚马逊每股的当前价格是多少？
3. 美元兑人民币的当前汇率是多少？


<img width="221" height="313" alt="image" src="https://github.com/user-attachments/assets/49c92101-3443-4639-840c-0f9a84a683f4" />

### 8.2 工具选择（Tool Selection）
- **工具选择**是工具学习过程中的**关键步骤**，它紧接着**任务规划阶段**。
- 在这个阶段，需要从可用的**工具集**中选择**最合适的工具**来解决**特定的子问题**。

### 8.2.1 工具选择的分类
1. **基于检索器的工具选择（Retriever - based Tool Selection）**：
   - 当**工具库庞大**时，使用**检索器**（如TF - IDF、BM25等）来从**大量工具**中检索出与**子问题最相关**的**前K个工具**。
   - 这种方法侧重于通过**关键词匹配**和**语义相似性**来快速**缩小工具选择范围**。
2. **基于LLM的工具选择（LLM - based Tool Selection）**：
   - 当**工具数量有限**或者在**检索阶段**已经缩小了**工具范围**时，可以直接将**工具描述**和**参数列表**与**用户查询**一起提供给**LLM**。
   - **LLM**需要根据**用户查询**和**工具描述**来选择**最合适的工具**。

### 8.2.2 工具选择的方法
- **无需微调的方法（Tuning - free Methods）**：
  - 利用**LLM的上下文学习能力**，通过**策略性提示**来增强**工具选择能力**。
  - 例如，通过**链式思维（Chain of Thought）**或**ReACT框架**来引导**LLM**进行**推理和行动**。
- **基于微调的方法（Tuning - based Methods）**：
  - 通过在**工具学习数据集**上微调**LLM的参数**来提高**工具选择的能力**。

### 8.2.3 举例

<img width="536" height="441" alt="image" src="https://github.com/user-attachments/assets/111fcba0-2e28-4682-abce-2485a1b26708" />

### 8.3 工具调用（Tool Calling）
- **工具调用**是工具学习流程中的**第三个阶段**，它紧跟在**工具选择**之后。
- 在这个阶段，**大型语言模型**需要根据**所选工具**的要求提取**用户查询**中的**必要参数**，并**调用工具服务器**获取数据。

### 8.3.1 工具调用的步骤
1. **参数提取**：**LLM**必须能够从**用户查询**中提取出符合**工具描述**中指定格式的参数。
2. **调用工具**：使用提取的参数向**工具服务器**发送请求，并接收响应。

### 8.3.2 工具调用的方法
- **无需微调的方法（Tuning - free Methods）**：
  - 利用**少量示例**或**规则方法**来指导**LLM**识别和提取参数。
- **基于微调的方法（Tuning - based Methods）**：
  - 通过微调**LLM**的参数来增强**工具调用能力**，使用特定的优化技术如**LoRA**。

### 8.3.3 举例

<img width="544" height="428" alt="image" src="https://github.com/user-attachments/assets/c2cb07f1-ba63-4159-8382-0f7fbaf76216" />

### 8.4 响应生成（Response Generation）
- **响应生成**是工具学习流程中的**最后一个阶段**，它涉及将**工具的输出**与**LLM的内部知识**结合起来，生成对用户的**全面响应**。
- 此阶段的目标是为用户提供**准确、相关且有用**的回答。

### 8.4.1 响应生成的方法
1. **直接插入方法（Direct Insertion Methods）**：
   - 在早期工作中，直接将**工具的输出**插入到生成的响应中。
   - 这种方法**简单直接**，但可能因为**工具输出的不可预测性**而影响用户体验。
2. **信息整合方法（Information Integration Methods）**：
   - 大多数方法选择将**工具的输出**作为**LLM的输入上下文**，使**LLM**能够根据**工具提供的信息**制定更优质的回答。
   - 由于**LLM的上下文长度有限**，需要采用不同的策略来处理**工具的长输出**。

### 8.4.2 举例

<img width="550" height="428" alt="image" src="https://github.com/user-attachments/assets/62a9b039-0d01-4a54-b559-90c01e2d5ae3" />


# 8.5-小结
1. **任务规划（Task Planning）**：模型首先解析用户输入，理解意图并将复杂任务拆解成多个可解决的子任务。
2. **工具选择（Tool Selection）**：根据每个子任务选择最适合的工具。工具选择分两种方式：
    - **Retriever - based selection**：使用检索模块选出 top - k 可能相关工具；
    - **LLM - based selection**：直接由模型判断并选择工具。
3. **工具调用（Tool Calling）**：模型需构建调用指令（如 API 请求、函数名 + 参数等），确保格式正确并执行调用。
4. **响应生成（Response Generation）**：收集工具返回结果，并将其恰当地整合进最终输出中。





